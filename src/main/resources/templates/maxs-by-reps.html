<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <title>Poids max par nombre de rÃ©ps</title>
</head>
<body>
<div th:insert="~{fragments/navbar :: navbar}"></div>
<p th:if="${successMessage}" th:text="${successMessage}" class="alert alert-success"></p>
<p th:if="${successRedMessage}" th:text="${successRedMessage}" class="alert alert-red"></p>

<div class="header-container">
    <h1><span th:text="${exerciseName}"></span> : maxs</h1>
    <a th:href="@{/exercises}" class="link-back">&#x293A;</a>
    <a th:href="@{/exerciseSets/byExercise/{id}/groupedByDateClean(id=${exercise_id})}" class="link-back">ðŸ“œ</a>
    <a th:href="@{/stats/recordHistory/{id}(id=${exercise_id})}" class="link-back">ðŸ“ˆ</a>

</div>


<table class="auto-width-table centered centered-text">
    <thead>
    <tr>

        <th colspan="3">PB</th>

        <th class="empty-separator"></th>

        <th colspan="3">SB</th>

        <th class="empty-separator"></th>

        <th th:colspan="${allYears.size()}+1">Poids</th>

    </tr>
    <tr>
        <!-- PB -->
        <th>Reps</th>
        <th>Poids</th>
        <th>Date</th>

        <th class="empty-separator"></th>

        <!-- SB -->
        <th>Reps</th>
        <th>Poids</th>
        <th>Date</th>

        <th class="empty-separator"></th>

        <!-- Years -->
        <th>Reps</th>
        <th th:each="year : ${allYears}"><span th:text="${year}"></span></th>

    </tr>
    </thead>
    <tbody>
    <tr th:each="combinedMax : ${combinedMaxs}">
        <!-- PBs -->
        <td th:text="${combinedMax.personalBest != null ? combinedMax.nbReps : '-'}" class="bold-text"></td>
        <td>
            <div th:if="${combinedMax.personalBest != null}">
                <div class="bold-text" th:text="${combinedMax.personalBest.maxWeight + ' kg'}"></div>
                <div class="small-text" th:text="${combinedMax.personalBest.RMest + ' kg'}"></div>
            </div>
            <div th:unless="${combinedMax.personalBest != null}">-</div>
        </td>
        <td th:text="${combinedMax.personalBest != null ? #temporals.format(combinedMax.personalBest.date, 'dd/MM/yyyy') : '-'}"></td>

        <!-- SÃ©parateur pour sÃ©parer PB et SB -->
        <td class="empty-separator"></td>

        <!-- SBs pour l'annÃ©e en cours -->
        <td th:text="${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')) != null ? combinedMax.nbReps : '-'}" class="bold-text"></td>
        <td>
            <div th:with="currentYear=${#dates.format(#dates.createNow(), 'yyyy')},
                 yearlyBest=${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy'))}">
                <div th:if="${yearlyBest != null}">
                    <div class="bold-text" th:text="${yearlyBest.maxWeight + ' kg'}"></div>
                    <div class="small-text" th:text="${yearlyBest.RMest + ' kg'}"></div>
                </div>
                <div th:unless="${yearlyBest != null}">-</div>
            </div>
        </td>
        <td><span th:text="${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')) != null ?
        #temporals.format(combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')).date(), 'dd/MM/yyyy') : '-'}"></span></td>

        <!-- SÃ©parateur pour sÃ©parer les SBs et les anciennes annÃ©es -->
        <td class="empty-separator"></td>

        <td th:text="${combinedMax.nbReps}" class="bold-text"></td>
        <td th:each="year : ${allYears}">
            <div th:if="${combinedMax.getYearlyBest(year) != null}">
                <div class="max-weight-container">
                    <div class="values-container">
                        <div class="bold-text" th:text="${combinedMax.getYearlyBest(year).maxWeight() + ' kg'}"></div>
                        <div class="small-text" th:text="${combinedMax.getYearlyBest(year).RMest() + ' kg'}"></div>
                    </div>
                    <div th:if="${combinedMax.getYearlyBest(year) != null and combinedMax.bestsByYear().get(year).trend() != null}"
                         th:class="${'trend-indicator ' + combinedMax.bestsByYear().get(year).trend().getCssClass()}">
                    </div>
                </div>
            </div>
            <div th:unless="${combinedMax.getYearlyBest(year) != null}">-</div>
        </td>

    </tr>

    <tr class="empty-separator-row">
        <td th:colspan="${9 + allYears.size()}" class="empty-separator"></td>
    </tr>

    <!-- Ligne pour Ratio Max -->
    <tr class="ratio-row"  th:with="currentYear=${#dates.year(#dates.createNow())},
                              currentYearData=${yearlyMaxRatioSets != null ? yearlyMaxRatioSets.get(currentYear) : null}">
        <td class="ratio-label bold-text">Max</td>
        <td class="ratio-global-value" th:if="${maxRatioSet != null}">
            <div class="bold-text">[[${#numbers.formatDecimal(maxRatioSet.ratio, 1, 3)}]]</div>
            <div class="small-text">[[${maxRatioSet.repNumber}]]x[[${maxRatioSet.weight}]]kg</div>
            <div class="small-text">@ [[${maxRatioSet.bodyWeight}]]kg</div>
        </td>
        <td class="ratio-global-value" th:if="${maxRatioSet != null}">
            [[${#temporals.format(maxRatioSet.workoutDate, 'dd/MM/yyyy')}]]
        </td>
        <td class="empty-separator"></td>
        <td class="bold-text">Max</td>
        <td class="ratio-global-value">
            <div th:if="${currentYearData.bestRatio() != null}">
                <div class="bold-text" th:text="${#numbers.formatDecimal(currentYearData.bestRatio().ratio(), 1, 3)}"></div>
                <div class="small-text" th:text="${currentYearData.bestRatio().repNumber() + 'x' + #numbers.formatDecimal(currentYearData.bestRatio().weight(), 1, 2) + 'kg'}"></div>
                <div class="small-text" th:text="${'@ ' + #numbers.formatDecimal(currentYearData.bestRatio().bodyWeight(), 1, 1) + 'kg'}"></div>
            </div>
            <div th:unless="${currentYearData.bestRatio() != null}">*</div>
        </td>

        <!-- DeuxiÃ¨me colonne : Date -->
        <td class="ratio-global-value">
            <div th:if="${currentYearRatio != null}">
                <span th:text="${#temporals.format(currentYearRatio.workoutDate(), 'dd/MM/yyyy')}"></span>
            </div>
            <div th:unless="${currentYearRatio != null}">/</div>
        </td>
        <td th:unless="${maxRatioSet != null}" colspan="3">-</td>
        <td class="empty-separator"></td>
        <td class="bold-text">Max</td>
        <td th:each="year : ${allYears}">
            <div th:with="yearlyData=${yearlyMaxRatioSets != null ? yearlyMaxRatioSets.get(year) : null}">
                <div th:if="${yearlyData != null}">
                    <div class="max-weight-container">
                        <div class="values-container">
                            <div class="bold-text">[[${#numbers.formatDecimal(yearlyData.bestRatio().ratio(), 1, 3)}]]</div>
                            <div class="small-text">
                                [[${yearlyData.bestRatio().repNumber()}]]x[[${#numbers.formatDecimal(yearlyData.bestRatio().weight(), 1, 1)}]]kg
                            </div>
                            <div class="small-text">
                                @ [[${#numbers.formatDecimal(yearlyData.bestRatio().bodyWeight(), 1, 1)}]]kg
                            </div>
                        </div>
                        <!-- Pastille trend -->
                        <div th:if="${yearlyData.trend() != null}"
                             th:classappend="${'trend-indicator ' + yearlyData.trend().getCssClass()}">
                        </div>
                    </div>
                </div>
                <div th:unless="${yearlyData != null}">-</div>
            </div>
        </td>
    </tr>

    <!-- Ligne pour Ratio 1RM -->
    <tr class="ratio-row"  th:with="currentYear=${#dates.year(#dates.createNow())},
                              currentYearRatio=${yearlyMaxRatio1RMSets != null ? yearlyMaxRatio1RMSets.get(currentYear) : null}">
        <td class="ratio-label bold-text">Est</td>
        <td class="ratio-global-value" th:if="${maxRatio1RMSet != null}">
            <div class="bold-text">[[${#numbers.formatDecimal(maxRatio1RMSet.ratio, 1, 3)}]]</div>
            <div class="small-text">[[${maxRatio1RMSet.repNumber}]]x[[${maxRatio1RMSet.weight}]]kg</div>
            <div class="small-text">([[${#numbers.formatDecimal(maxRatio1RMSet.est1RM, 1, 1)}]]kg)</div>
            <div class="small-text">@ [[${maxRatio1RMSet.bodyWeight}]]kg</div>
        </td>
        <td class="ratio-global-value" th:if="${maxRatio1RMSet != null}">
            [[${#temporals.format(maxRatio1RMSet.workoutDate, 'dd/MM/yyyy')}]]
        </td>
        <td th:unless="${maxRatio1RMSet != null}" colspan="3">-</td>

        <td class="empty-separator"></td>

        <td class="bold-text">Est</td>

        <td class="ratio-global-value">
            <div th:if="${currentYearData != null}">
                <div class="bold-text" th:text="${#numbers.formatDecimal(currentYearData.bestRatio().ratio(), 1, 3)}"></div>
                <div class="small-text" th:text="${currentYearData.bestRatio().repNumber() + 'x' + #numbers.formatDecimal(currentYearData.bestRatio().weight(), 1, 2) + 'kg'}"></div>
                <div class="small-text" th:text="${'(' + #numbers.formatDecimal(currentYearData.bestRatio().est1RM(), 1, 2) + 'kg)'}"></div>
                <div class="small-text" th:text="${'@ ' + #numbers.formatDecimal(currentYearData.bestRatio().bodyWeight(), 1, 1) + 'kg'}"></div>
            </div>
            <div th:unless="${currentYearData != null}">-</div>
        </td>

        <!-- DeuxiÃ¨me colonne : Date -->
        <td class="ratio-global-value">
            <div th:if="${currentYearData != null}">
                <span th:text="${#temporals.format(currentYearData.bestRatio().workoutDate(), 'dd/MM/yyyy')}"></span>
            </div>
            <div th:unless="${currentYearData != null}">-</div>
        </td>

        <td class="empty-separator"></td>
        <td class="bold-text">Est</td>
        <td th:each="year : ${allYears}">
            <div th:with="yearlyData=${yearlyMaxRatio1RMSets != null ? yearlyMaxRatio1RMSets.get(year) : null}">
                <div th:if="${yearlyData != null}" class="ratio-value">
                    <div class="max-weight-container">
                        <div class="values-container">
                            <div class="bold-text">[[${#numbers.formatDecimal(yearlyData.bestRatio().ratio(), 1, 3)}]]</div>
                            <div class="small-text">[[${yearlyData.bestRatio().repNumber()}]]x[[${#numbers.formatDecimal(yearlyData.bestRatio().weight(), 1, 2)}]]kg</div>
                            <div class="small-text">([[${#numbers.formatDecimal(yearlyData.bestRatio().est1RM(), 1, 2)}]]kg)</div>
                            <div class="small-text">@ [[${#numbers.formatDecimal(yearlyData.bestRatio().bodyWeight(), 1, 1)}]]kg</div>
                        </div>
                        <!-- Pastille trend -->
                        <div th:if="${yearlyData.trend() != null}"
                             th:classappend="${'trend-indicator ' + yearlyData.trend().getCssClass()}">
                        </div>
                    </div>
                </div>
                <div th:unless="${yearlyData != null}">-</div>
            </div>
        </td>
    </tr>

    </tbody>
</table>

<script src="/js/timer.js"></script>
</body>
</html>