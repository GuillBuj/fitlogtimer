<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <title>Poids max par nombre de rÃ©ps</title>
</head>
<body>
<div th:insert="~{fragments/navbar :: navbar}"></div>
<p th:if="${successMessage}" th:text="${successMessage}" class="alert alert-success"></p>
<p th:if="${successRedMessage}" th:text="${successRedMessage}" class="alert alert-red"></p>

<div class="header-container">
    <h1><span th:text="${exerciseName}"></span> : maxs</h1>
    <a th:href="@{/exercises}" class="link-back">&#x293A;</a>
    <a th:href="@{/exerciseSets/byExercise/{id}/groupedByDateClean(id=${exercise_id})}" class="link-back">ðŸ“œ</a>
    <a th:href="@{/stats/recordHistory/{id}(id=${exercise_id})}" class="link-back">ðŸ“ˆ</a>
</div>

<table th:if="${exercise_type == 'FREE_WEIGHT'}" class="auto-width-table centered centered-text">
    <thead>
    <tr>
        <th colspan="3">Records</th>
        <th class="empty-separator"></th>
        <th colspan="3">Records sur l'annÃ©e</th>
        <th class="empty-separator"></th>
        <th th:colspan="${allYears.size()}+1">Poids</th>
    </tr>
    <tr>
        <!-- PB -->
        <th>Reps</th>
        <th>Poids</th>
        <th>Date</th>
        <th class="empty-separator"></th>
        <!-- SB -->
        <th>Reps</th>
        <th>Poids</th>
        <th>Date</th>
        <th class="empty-separator"></th>
        <!-- Years -->
        <th>Reps</th>
        <th th:each="year : ${allYears}"><span th:text="${year}"></span></th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="combinedMax : ${combinedMaxs}">
        <!-- PBs -->
        <td th:text="${combinedMax.personalBest != null ? combinedMax.nbReps : '-'}" class="bold-text"></td>
        <td>
            <a th:if="${combinedMax.personalBest != null}" th:href="@{/workouts/{id}(id=${combinedMax.personalBest.workoutId})}" class="soft-link">
            <div th:if="${combinedMax.personalBest != null}">
                <div class="bold-text">
                        [[${combinedMax.personalBest.maxWeight}]] kg
                </div>
                <div class="small-text" th:text="${combinedMax.personalBest.RMest + ' kg'}"></div>
            </div>
            </a>
            <div th:unless="${combinedMax.personalBest != null}">-</div>
        </td>
        <td>
            <a th:if="${combinedMax.personalBest != null}" th:href="@{/workouts/{id}(id=${combinedMax.personalBest.workoutId})}" class="soft-link">
                <div th:if="${combinedMax.personalBest != null}"
                     th:text="${combinedMax.personalBest != null ? #temporals.format(combinedMax.personalBest.date, 'dd/MM/yyyy') : '-'}">
                </div>
            </a>
        </td>

        <!-- SÃ©parateur pour sÃ©parer PB et SB -->
        <td class="empty-separator"></td>

        <!-- SBs pour l'annÃ©e en cours -->
        <td th:text="${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')) != null ? combinedMax.nbReps : '-'}" class="bold-text"></td>
        <td>
            <div th:with="currentYear=${#dates.format(#dates.createNow(), 'yyyy')},
                 yearlyBest=${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy'))}">
                <a th:if="${yearlyBest != null}" th:href="@{/workouts/{id}(id=${yearlyBest.workoutId})}" class="soft-link">
                <div th:if="${yearlyBest != null}">
                    <div class="bold-text" th:text="${yearlyBest.maxWeight + ' kg'}"></div>
                    <div class="small-text" th:text="${yearlyBest.RMest + ' kg'}"></div>
                </div>
                <div th:unless="${yearlyBest != null}">-</div>
                </a>
            </div>
        </td>
        <td>
            <a th:if="${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')) != null}"
               th:href="@{/workouts/{id}(id=${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')).workoutId})}"
               class="soft-link">
            <span th:text="${combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')) != null ?
        #temporals.format(combinedMax.getYearlyBest(#dates.format(#dates.createNow(), 'yyyy')).date(), 'dd/MM/yyyy') : '-'}">
            </span>
            </a>
        </td>

        <!-- SÃ©parateur pour sÃ©parer les SBs et les anciennes annÃ©es -->
        <td class="empty-separator"></td>

        <td th:text="${combinedMax.nbReps}" class="bold-text"></td>
        <td th:each="year : ${allYears}">
            <div th:if="${combinedMax.getYearlyBest(year) != null}">
                <a th:if="${combinedMax.getYearlyBest(year) != null}" th:href="@{/workouts/{id}(id=${combinedMax.getYearlyBest(year).workoutId})}" class="soft-link">
                <div class="max-weight-container">
                    <div class="values-container">
                        <div class="bold-text" th:text="${combinedMax.getYearlyBest(year).maxWeight() + ' kg'}"></div>
                        <div class="small-text" th:text="${combinedMax.getYearlyBest(year).RMest() + ' kg'}"></div>
                    </div>
                    <div th:if="${combinedMax.getYearlyBest(year) != null and combinedMax.bestsByYear().get(year).trend() != null}"
                         th:class="${'trend-indicator ' + combinedMax.bestsByYear().get(year).trend().getCssClass()}">
                    </div>
                </div>
                </a>
            </div>
            <div th:unless="${combinedMax.getYearlyBest(year) != null}">-</div>
        </td>
    </tr>

    <tr class="empty-separator-row">
        <td th:colspan="${9 + allYears.size()}" class="empty-separator"></td>
    </tr>

    <!-- Ligne pour Ratio Max -->
    <tr class="ratio-row"  th:with="currentYear=${#dates.year(#dates.createNow())},
                              currentYearData=${yearlyMaxRatioSets != null ? yearlyMaxRatioSets.get(currentYear) : null}">
        <td class="ratio-label bold-text">Max</td>
        <td class="ratio-global-value" th:if="${maxRatioSet != null}">
            <a th:if="${maxRatioSet != null}" th:href="@{/workouts/{id}(id=${maxRatioSet.idWorkout})}" class="soft-link">
                <div class="bold-text">[[${#numbers.formatDecimal(maxRatioSet.ratio, 1, 3)}]]</div>
                <div class="small-text">[[${maxRatioSet.repNumber}]]x[[${maxRatioSet.weight}]]kg</div>
                <div class="small-text">@ [[${maxRatioSet.bodyWeight}]]kg</div>
            </a>
        </td>
        <td class="ratio-global-value" th:if="${maxRatioSet != null}">
            <a th:if="${maxRatioSet != null}" th:href="@{/workouts/{id}(id=${maxRatioSet.idWorkout})}" class="soft-link">
            [[${#temporals.format(maxRatioSet.workoutDate, 'dd/MM/yyyy')}]]
            </a>
        </td>

        <td class="empty-separator"></td>

        <td class="bold-text">Max</td>
        <td class="ratio-global-value">
            <div th:if="${currentYearData.bestRatio() != null}">
                <a th:if="${currentYearData.bestRatio() != null}" th:href="@{/workouts/{id}(id=${currentYearData.bestRatio().idWorkout})}" class="soft-link">
                <div class="bold-text" th:text="${#numbers.formatDecimal(currentYearData.bestRatio().ratio(), 1, 3)}"></div>
                <div class="small-text" th:text="${currentYearData.bestRatio().repNumber() + 'x' + #numbers.formatDecimal(currentYearData.bestRatio().weight(), 1, 2) + 'kg'}"></div>
                <div class="small-text" th:text="${'@ ' + #numbers.formatDecimal(currentYearData.bestRatio().bodyWeight(), 1, 1) + 'kg'}"></div>
                </a>
            </div>
            <div th:unless="${currentYearData.bestRatio() != null}">*</div>
        </td>
        <td class="ratio-global-value">
            <div th:if="${currentYearData.bestRatio().workoutDate() != null}">
                <a th:if="${currentYearData.bestRatio() != null}" th:href="@{/workouts/{id}(id=${currentYearData.bestRatio().idWorkout})}" class="soft-link">
                [[${#temporals.format(currentYearData.bestRatio().workoutDate(), 'dd/MM/yyyy')}]]
                </a>
            </div>
            <div th:unless="${currentYearData.bestRatio().workoutDate() != null}">/</div>
        </td>
        <td th:unless="${maxRatioSet != null}" colspan="3">-</td>

        <td class="empty-separator"></td>

        <td class="bold-text">Max</td>
        <td th:each="year : ${allYears}">
            <div th:with="yearlyData=${yearlyMaxRatioSets != null ? yearlyMaxRatioSets.get(year) : null}">
                <div th:if="${yearlyData != null}">
                    <a th:if="${yearlyData != null}" th:href="@{/workouts/{id}(id=${yearlyData.bestRatio().idWorkout})}" class="soft-link">
                    <div class="max-weight-container">
                        <div class="values-container">
                            <div class="bold-text">[[${#numbers.formatDecimal(yearlyData.bestRatio().ratio(), 1, 3)}]]</div>
                            <div class="small-text">
                                [[${yearlyData.bestRatio().repNumber()}]]x[[${#numbers.formatDecimal(yearlyData.bestRatio().weight(), 1, 1)}]]kg
                            </div>
                            <div class="small-text">
                                @ [[${#numbers.formatDecimal(yearlyData.bestRatio().bodyWeight(), 1, 1)}]]kg
                            </div>
                        </div>
                        <!-- Pastille trend -->
                        <div th:if="${yearlyData.trend() != null}"
                             th:classappend="${'trend-indicator ' + yearlyData.trend().getCssClass()}">
                        </div>
                    </div>
                    </a>
                </div>
                <div th:unless="${yearlyData != null}">-</div>
            </div>
        </td>
    </tr>

    <!-- Ligne pour Ratio 1RM -->
    <tr class="ratio-row"  th:with="currentYear=${#dates.year(#dates.createNow())},
                              currentYearData=${yearlyMaxRatio1RMSets != null ? yearlyMaxRatio1RMSets.get(currentYear) : null}">
        <td class="ratio-label bold-text">Est</td>
        <td class="ratio-global-value" th:if="${maxRatio1RMSet != null}">
            <a th:if="${maxRatio1RMSet != null}" th:href="@{/workouts/{id}(id=${maxRatio1RMSet.idWorkout})}" class="soft-link">
            <div class="bold-text">[[${#numbers.formatDecimal(maxRatio1RMSet.ratio, 1, 3)}]]</div>
            <div class="small-text">[[${maxRatio1RMSet.repNumber}]]x[[${maxRatio1RMSet.weight}]]kg</div>
            <div class="small-text">([[${#numbers.formatDecimal(maxRatio1RMSet.est1RM, 1, 1)}]]kg)</div>
            <div class="small-text">@ [[${maxRatio1RMSet.bodyWeight}]]kg</div>
            </a>
        </td>
        <td th:unless="${maxRatio1RMSet != null}">-</td>
        <td class="ratio-global-value" th:if="${maxRatio1RMSet != null}">
            <a th:if="${maxRatio1RMSet != null}" th:href="@{/workouts/{id}(id=${maxRatio1RMSet.idWorkout})}" class="soft-link">
            [[${#temporals.format(maxRatio1RMSet.workoutDate, 'dd/MM/yyyy')}]]
            </a>
        </td>
        <td th:unless="${maxRatio1RMSet != null}" colspan="3">-</td>

        <td class="empty-separator"></td>

        <td class="bold-text">Est</td>
        <td class="ratio-global-value">
            <div th:if="${currentYearData.bestRatio() != null}">
                <a th:if="${currentYearData.bestRatio() != null}" th:href="@{/workouts/{id}(id=${currentYearData.bestRatio().idWorkout})}" class="soft-link">
                <div class="bold-text" th:text="${#numbers.formatDecimal(currentYearData.bestRatio().ratio(), 1, 3)}"></div>
                <div class="small-text" th:text="${currentYearData.bestRatio().repNumber() + 'x' + #numbers.formatDecimal(currentYearData.bestRatio().weight(), 1, 2) + 'kg'}"></div>
                <div class="small-text" th:text="${'(' + #numbers.formatDecimal(currentYearData.bestRatio().est1RM(), 1, 2) + 'kg)'}"></div>
                <div class="small-text" th:text="${'@ ' + #numbers.formatDecimal(currentYearData.bestRatio().bodyWeight(), 1, 1) + 'kg'}"></div>
                </a>
            </div>
            <div th:unless="${currentYearData.bestRatio() != null}">-</div>
        </td>
        <td class="ratio-global-value">
            <div th:if="${currentYearData.bestRatio() != null}">
                <a th:if="${currentYearData.bestRatio() != null}" th:href="@{/workouts/{id}(id=${currentYearData.bestRatio().idWorkout})}" class="soft-link">
                [[${#temporals.format(currentYearData.bestRatio().workoutDate(), 'dd/MM/yyyy')}]]
                </a>
            </div>
            <div th:unless="${currentYearData.bestRatio() != null}">-</div>
        </td>

        <td class="empty-separator"></td>

        <td class="bold-text">Est</td>
        <td th:each="year : ${allYears}">
            <div th:with="yearlyData=${yearlyMaxRatio1RMSets != null ? yearlyMaxRatio1RMSets.get(year) : null}">
                <div th:if="${yearlyData != null}" class="ratio-value">
                    <a th:if="${yearlyData.bestRatio() != null}" th:href="@{/workouts/{id}(id=${yearlyData.bestRatio().idWorkout})}" class="soft-link">
                    <div class="max-weight-container">
                        <div class="values-container">
                            <div class="bold-text">[[${#numbers.formatDecimal(yearlyData.bestRatio().ratio(), 1, 3)}]]</div>
                            <div class="small-text">[[${yearlyData.bestRatio().repNumber()}]]x[[${#numbers.formatDecimal(yearlyData.bestRatio().weight(), 1, 2)}]]kg</div>
                            <div class="small-text">([[${#numbers.formatDecimal(yearlyData.bestRatio().est1RM(), 1, 2)}]]kg)</div>
                            <div class="small-text">@ [[${#numbers.formatDecimal(yearlyData.bestRatio().bodyWeight(), 1, 1)}]]kg</div>
                        </div>
                        <!-- Pastille trend -->
                        <div th:if="${yearlyData.trend() != null}"
                             th:classappend="${'trend-indicator ' + yearlyData.trend().getCssClass()}">
                        </div>
                    </div>
                    </a>
                </div>
                <div th:unless="${yearlyData != null}">-</div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<table th:if="${exercise_type != 'FREE_WEIGHT'}" class="auto-width-table centered centered-text">
    <thead>
    <tr>
        <th colspan="2">Record absolu</th>
        <th class="empty-separator"></th>
        <th colspan="2">Record cette annÃ©e</th>
        <th class="empty-separator"></th>
        <th th:colspan="${allYears.size()}">Historique par annÃ©e</th>
    </tr>
    <tr>
        <th>
            <span th:if="${exercise_type == 'ISOMETRIC'}">DurÃ©e</span>
            <span th:if="${exercise_type == 'BODYWEIGHT'}">Reps</span>
        </th>
        <th>Date</th>
        <th class="empty-separator"></th>
        <th>
            <span th:if="${exercise_type == 'ISOMETRIC'}">DurÃ©e</span>
            <span th:if="${exercise_type == 'BODYWEIGHT'}">Reps</span>
        </th>
        <th>Date</th>
        <th class="empty-separator"></th>
        <th th:each="year : ${allYears}"><span th:text="${year}"></span></th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td th:if="${simpleMaxs.personalBest() != null}" class="bold-text">
    <span th:if="${exercise_type == 'ISOMETRIC'}">
        <span th:text="${#numbers.formatInteger(simpleMaxs.personalBest().maxValue() / 60, 1)}"></span>'
        <span th:text="${#numbers.formatInteger(simpleMaxs.personalBest().maxValue() % 60, 2)}"></span>"
    </span>
            <span th:if="${exercise_type == 'BODYWEIGHT'}" th:text="${simpleMaxs.personalBest().maxValue()}"></span>
        </td>
        <td th:unless="${simpleMaxs.personalBest() != null}">-</td>

        <td th:if="${simpleMaxs.personalBest() != null}">
            <span th:text="${#temporals.format(simpleMaxs.personalBest().date(), 'dd/MM/yyyy')}"></span>
        </td>
        <td th:unless="${simpleMaxs.personalBest() != null}">-</td>

        <td class="empty-separator"></td>

        <td th:with="currentYear=${#dates.year(#dates.createNow())},
             currentYearBest=${simpleMaxs.getYearlyBest(currentYear)}">
    <span th:if="${currentYearBest != null}" class="bold-text">
        <span th:if="${exercise_type == 'ISOMETRIC'}">
            <span th:text="${#numbers.formatInteger(currentYearBest.maxValue() / 60, 1)}"></span>'
            <span th:text="${#numbers.formatInteger(currentYearBest.maxValue() % 60, 2)}"></span>"
        </span>
        <span th:if="${exercise_type == 'BODYWEIGHT'}" th:text="${currentYearBest.maxValue()}"></span>
    </span>
            <span th:unless="${currentYearBest != null}">-</span>
        </td>

        <td th:with="currentYear=${#dates.year(#dates.createNow())},
             currentYearBest=${simpleMaxs.getYearlyBest(currentYear)}">
    <span th:if="${currentYearBest != null}">
        <span th:text="${#temporals.format(currentYearBest.date(), 'dd/MM/yyyy')}"></span>
    </span>
            <span th:unless="${currentYearBest != null}">-</span>
        </td>

        <td class="empty-separator"></td>

        <!-- Historique par annÃ©e -->
        <td th:each="year : ${allYears}">
            <div th:with="yearlyBest=${simpleMaxs.getYearlyBest(year)}">
                <div th:if="${yearlyBest != null}" class="max-weight-container">
                    <div class="values-container">
                        <div class="bold-text">
                    <span th:if="${exercise_type == 'ISOMETRIC'}">
                        <span th:text="${#numbers.formatInteger(yearlyBest.maxValue() / 60, 1)}"></span>'
                        <span th:text="${#numbers.formatInteger(yearlyBest.maxValue() % 60, 2)}"></span>"
                    </span>
                            <span th:if="${exercise_type == 'BODYWEIGHT'}" th:text="${yearlyBest.maxValue()}"></span>
                        </div>
                        <div class="small-text" th:text="${#temporals.format(yearlyBest.date(), 'dd/MM/yyyy')}"></div>
                    </div>
                    <!-- Pastille trend -->
                    <div th:if="${simpleMaxs.bestsByYear().get(year) != null and simpleMaxs.bestsByYear().get(year).trend() != null}"
                         th:class="${'trend-indicator ' + simpleMaxs.bestsByYear().get(year).trend().getCssClass()}">
                    </div>
                </div>
                <div th:unless="${yearlyBest != null}">-</div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<script src="/js/timer.js"></script>
</body>
</html>