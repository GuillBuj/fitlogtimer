<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <title>Progression par mois</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
<div th:insert="~{fragments/navbar :: navbar}"></div>
<div class="header-container">
    <h2>Max mensuel</h2>
</div>

<div id="monthlyChartContainer">
    <canvas id="monthlyChart"></canvas>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const chartData = /*[[${chartData}]]*/ [];

    // Solution simple : utiliser l'index comme axe X
    const exercises = [...new Set(chartData.map(d => d.exerciseName))];
    const months = [...new Set(chartData.map(d => d.period))].sort();

    const colors = [
        'rgba(54, 162, 235, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 206, 86, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(255, 99, 132, 0.7)'
    ];

    const datasets = exercises.map((exercise, idx) => {
        const exerciseData = chartData.filter(d => d.exerciseName === exercise);
        return {
            label: exercise,
            data: months.map(month => {
                const dataPoint = exerciseData.find(d => d.period === month);
                return dataPoint ? dataPoint.max : null;
            }),
            borderColor: colors[idx % colors.length],
            backgroundColor: colors[idx % colors.length],
            tension: 0.3,
            fill: false,
            pointRadius: 4,
            pointHoverRadius: 6
        };
    });

    new Chart(document.getElementById('monthlyChart'), {
        type: 'line',
        data: {
            labels: months,
            datasets: datasets
        },
        options: {
            responsive: true,
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            scales: {
                x: {
                    title: { display: true, text: 'Mois' }
                },
                y: {
                    beginAtZero: false,
                    title: { display: true, text: 'Poids (kg)' }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: { usePointStyle: true }
                }
            }
        }
    });
    /*]]>*/
</script>
</body>
</html>
